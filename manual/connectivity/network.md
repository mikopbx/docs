# Сетевые интерфейсы

**Имя хоста** - это имя машины. Если значение не указано, то используется имя **mikopbx.local**.

<figure><img src="../../.gitbook/assets/1 (22).png" alt=""><figcaption></figcaption></figure>

## Сетевые интерфейсы

Существует два способа настроить IP-адрес в MikoPBX:

1. **DHCP (Dynamic Host Configuration Protocol)** - это протокол, который позволяет автоматически настраивать IP-адрес. Рекомендуется использовать этот способ, если вы не хотите заниматься ручной настройкой. Просто включите опцию "**Использовать DHCP для получения настроек сети**" и система автоматически получит IP-адрес от DHCP сервера.
2. **Ручная настройка** - если вы не хотите использовать DHCP или хотите задать IP-адрес вручную, вы можете выполнить ручную настройку сети. Для этого вам понадобятся некоторые знания о топологии сети. В поле IP-адрес введите желаемый IP-адрес, а рядом с ним укажите маску подсети в формате CIDR. Например, /24 соответствует маске подсети 255.255.255.0.

"**VLAN ID**" - Кроме того, MikoPBX поддерживает виртуальные сетевые интерфейсы, известные как VLAN. Эта функция особенно полезна, если у вас есть только один физический сетевой интерфейс, но вам требуется использовать несколько виртуальных интерфейсов. С помощью VLAN можно создать виртуальные интерфейсы, которые работают поверх физического интерфейса. Преимуществом использования VLAN является возможность направлять телефонные разговоры через него, в то время как сетевое оборудование может осуществлять отдельную обработку трафика VLAN, обеспечивая стабильное соединение.

Важно отметить, что количество сетевых интерфейсов в MikoPBX не ограничено, и вы можете настроить и использовать несколько интерфейсов в соответствии с вашими потребностями.

<figure><img src="../../.gitbook/assets/2 (6).png" alt=""><figcaption></figcaption></figure>

## Топология сети

"**Сетевой интерфейс с доступом в интернет**" - это основной интерфейс, через который MikoPBX будет получать доступ к внешним адресам, то есть адресам вне вашей локальной сети.

Если вы не указали адрес **DNS-сервера**, MikoPBX будет использовать сервер 8.8.8.8 по умолчанию. DNS-серверы отвечают за преобразование доменных имен в IP-адреса, позволяя устройствам находить нужные ресурсы в сети.

В зависимости от топологии вашей сети, вам потребуется выполнить определенные настройки MikoPBX. Вариант, когда АТС находится за сетевым маршрутизатором, является наиболее распространенным. Это означает, что MikoPBX подключена к вашей локальной сети, и для доступа к интернету используется маршрутизатор. Другой вариант - АТС находится на публичном IP, то есть имеет прямой доступ к интернету без промежуточного маршрутизатора.

В обоих случаях необходимо настроить MikoPBX соответствующим образом, чтобы обеспечить правильное функционирование и доступ к внешним ресурсам.

* Если АТС находится **за маршрутизатором**, то необходимо установить галку «**Эта станция расположена за NAT маршрутизатором**»
* Если нам известен **внешний адрес** станции (ip или доменное имя)и **проброшены порты** АТС во внешний мир, то имеет смысл заполнить поля «**Внешний IP адрес Вашего маршрутизатора**» или «**Внешнее имя хоста вашего маршрутизатора**».

Всем адресам, которые не являются для АТС локальными, станция будет представляться внешним адресом:

* Если «Внешний IP адрес Вашего маршрутизатора» пустое, а «Внешнее имя хоста вашего маршрутизатора» заполнено, то АТС будет представляться именно этим полем (Внешнее имя).\


{% hint style="info" %}
Внешний IP-адрес обязателен для заполнения. Если указано доменное имя - то приоритет за ним и Внешний IP адрес не используется.
{% endhint %}

<figure><img src="../../.gitbook/assets/3 (3).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Когда вы включаете опцию «**Эта станция расположена за NAT маршрутизатором**», важно указать внешний адрес или имя хоста вашего маршрутизатора. Это необходимо для правильной настройки связи между внешней сетью и вашей АТС. Помимо этого, на самом маршрутизаторе необходимо выполнить проброс портов SIP 5060 и RTP 10000-10200 на локальный адрес АТС. Проброс портов позволяет маршрутизатору правильно направлять сетевой трафик SIP и RTP к вашей АТС.

Однако, если ваш провайдер позволяет вам регистрироваться без использования NAT и у вас нет необходимости подключать внешних абонентов, то вы можете не включать опцию «**Эта станция расположена за NAT маршрутизатором**». Даже если ваша АТС находится за NAT-маршрутизатором, но вы не нуждаетесь во внешних подключениях, эта опция не обязательна.

Важно учитывать требования вашего провайдера и особенности вашей сети при выборе и настройке этой опции.
{% endhint %}

## Ручная настройка сетевых маршрутов

1. Перейдите в раздел **Система** → **Кастомизация системных файлов**.

<figure><img src="../../.gitbook/assets/4 (25).png" alt=""><figcaption></figcaption></figure>

2. &#x20;Откройте для редактирования файл **/etc/static-routes**.

<figure><img src="../../.gitbook/assets/5 (9).png" alt=""><figcaption></figcaption></figure>

3. &#x20;Выберите режим «**Заменять полностью**» и вставьте правило.\
   Например, **route add -net 54.246.198.136 netmask 255.255.255.255 gw 172.16.32.15 dev eth0**

<figure><img src="../../.gitbook/assets/6 (1).png" alt=""><figcaption></figcaption></figure>

Для указания операционной системе, какой сетевой интерфейс (в данном случае eth0) использовать для поиска IP-адреса **54.246.198.136**, а также для указания шлюза (gateway) для направления запроса (в данном случае **172.16.32.15**), мы задаем соответствующие значения в настройках сетевого правила.

Маска подсети "**255.255.255.255**" указывает, что данное правило будет применимо только к конкретному IP-адресу **54.246.198.136**. Если вам необходимо создать правило для группы адресов, например, для всей подсети **54.246.198.0**, то фактически это охватывает диапазон адресов от **54.246.198.1** до **54.246.198.254**.

Таким образом, указывая сетевой интерфейс и шлюз в сетевых настройках, вы определяете, какую сеть и через какой маршрут направлять соответствующие запросы и коммуникацию. Это важно для настройки сетевого взаимодействия и обеспечения правильной маршрутизации трафика в вашей сети.

Нажмите "**Сохранить**"
