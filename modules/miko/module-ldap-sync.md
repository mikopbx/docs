# Синхронизация с LDAP/AD

Этот модуль предназначен для двусторонней синхронизации учетных данных сотрудников с MikoPBX. Источником данных служит сервер Active Directory или LDAP.&#x20;

При создании нового сотрудника в домене он будет автоматически загружен в MikoPBX, с присвоением свободного внутреннего номера. Информация о номере будет передана обратно в домен и записана в карточке сотрудника. То же самое произойдет с мобильным телефоном и фотографией. Настройка, как всегда, максимально простая.

<figure><img src="../../.gitbook/assets/ModuleLdapSync - indexRU.png" alt=""><figcaption><p>Настройка серверов Active Directory для синхронизации пользователей с MikoPBX</p></figcaption></figure>

## Параметры синхронизации

Для каждого сервера AD/LDAP, вы можете указать настройки синхронизации, фильтры по отделам или создать произвольный фильтр для сложной логики фильтрации.

<figure><img src="../../.gitbook/assets/ModuleLdapSync - modify ru1.png" alt=""><figcaption><p>Настройка учетных данных контроллера домена</p></figcaption></figure>

## Атрибуты учетных записей

Далее необходимо корректно настроить атрибуты для синхронизации учетных записей.

<figure><img src="../../.gitbook/assets/ModuleLdapSync - modify ru2.png" alt=""><figcaption><p>Настройка атрибутов синхронизации между MikoPBX и доменом</p></figcaption></figure>

## Первичная синхронизация

Во время первой синхронизации, система сопоставит уже существующие в MikoPBX учетные записи с полученными из домена данными. Для поиска соответствий используются следующие поля:

* Адрес электронной почты
* Имя сотрудника
* Мобильный телефон
* Внутренний телефон

## Тестирование и запуск

Перед включением автоматической синхронизации рекомендуется проверить правильность указанных атрибутов, нажав на кнопку **Выполнить запрос**.

Если все параметры указаны верно, вы увидите список сотрудников с атрибутами из домена. Это безопасный запрос и не приведет к изменениям в системе.

<figure><img src="../../.gitbook/assets/ModuleLdapSync - modify 4 ru.png" alt=""><figcaption><p>Тестирование синхронизации данных с AD/LDAP</p></figcaption></figure>

## Последующие шаги

После тестирования можно запустить ручную или автоматическую синхронизацию данных.

<figure><img src="../../.gitbook/assets/ModuleLdapSync - modify 5ru.png" alt=""><figcaption><p>Статус синхронизации сотрудников между доменом и MikoPBX</p></figcaption></figure>

В колонках "_статус_" и "_обновлен_" можно отследить текущий процесс синхронизации.

### Удаление или отключение сотрудника в домене

При удалении или отключении сотрудника в домене он останется активным в MikoPBX, но будет перемещен в специальную таблицу “**Отключенные в LDAP/AD сотрудники**”. Его учетная запись будет сохранена до момента ее ручного удаления администратором MikoPBX. Это обусловлено тем, что возможны различные сложные сценарии маршрутизации вызовов, при которых невозможно просто удалить сотрудника из маршрута, не заменив его другим.

### Конфликты синхронизации

При синхронизации возможны конфликты, когда системе не удается создать или изменить данные сотрудника в MikoPBX или на стороне сервера LDAP/AD. Все проблемы синхронизации фиксируются модулем и записываются в специальную таблицу “**Конфликты синхронизации**”.&#x20;

Администратор MikoPBX может вручную решить возникшую проблему и очистить таблицу с конфликтами в модуле.

### Синхронизация паролей SIP

В модуле предусмотрена возможность синхронизации SIP паролей с контроллером домена. Это может быть удобно для автоматической настройки IP-телефонов в компании по данным из домена.&#x20;

Для включения синхронизации необходимо создать специальный атрибут на стороне контроллера домена и указать этот атрибут в поле “**Пароль SIP**” в настройке сопоставления атрибутов для синхронизации. Учтите, что пароль будет храниться в открытом виде. При включенной двусторонней синхронизации значение пароля из MikoPBX будет передаваться в домен и наоборот, в зависимости от даты последнего изменения.

Обратите внимание: пароль SIP не является паролем доменной учетной записи; это отдельное значение.
