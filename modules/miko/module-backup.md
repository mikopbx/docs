# Резервное копирование

{% hint style="danger" %}
**Обратите внимание**: в версии **2020.2.XXX** функционал резервного копирования выделен в отдельный модуль и отсутствует в основной поставке. Установка модуля доступна в разделе [Управление модулями](../../manual/modules/upravlenie-modulyami/)
{% endhint %}

## Создание архивной копии <a href="#sozdanie_arxivnoj_kopii" id="sozdanie_arxivnoj_kopii"></a>

1. Перейдите во вкладку **"Модули"** -> **"Управление модулями"**

Убедитесь, что **Модуль резервного копирования** установлен и включен

<figure><img src="../../.gitbook/assets/1 (15).png" alt=""><figcaption></figcaption></figure>

2. Перейдите в настройки модуля

<figure><img src="../../.gitbook/assets/2 (32).png" alt=""><figcaption></figcaption></figure>

3. Выполните действие «**Создать архивную копию**»

<figure><img src="../../.gitbook/assets/3 (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

4. Необходимо выбрать, какие именно данные будут включены в архивную копию АТС, т.е. какие данные необходимо сохранить:
   * **Настройки PBX** - все **настройки конфигурации** MikoPBX, которые были выполнены в web-интерфейсе в соответствующих разделах.
   * **История разговоров** - сохранение истории базы данных **cdr.db** (расположение: **/storage/usbdisk1/mikopbx/astlogs/asterisk/cdr.db**). Данная настройка не предполагает сохранение самих записей разговоров, т.е. будет сохранена вся информация на вкладке **Телефония** → **История вызовов** ([Документация](../../manual/telefoniya/call-detail-records.md)) без возможности прослушивания / скачивания файлов записей.
   * **Файлы с записями разговоров** - сохранение всех записей разговоров в формате \*.mp3.
   * **Звуковые файлы** - сохранение звуковых файлов, которые были загружены на АТС в разделе **Телефония** → **Звуковые файлы** ([Документация](../../manual/telefoniya/sound-files.md)).

<figure><img src="../../.gitbook/assets/4 (8).png" alt=""><figcaption></figcaption></figure>

5. Выполните действие «**Создать архивную копию**».

<figure><img src="../../.gitbook/assets/5 (15).png" alt=""><figcaption></figcaption></figure>

После завершения операции списке резервных копий появится новые данные:

<figure><img src="../../.gitbook/assets/6 (4).png" alt=""><figcaption></figcaption></figure>

## Управление файлами <a href="#upravlenie_fajlami" id="upravlenie_fajlami"></a>

В списке резервных копий есть возможность выполнить следующие действия:

* Восстановить из резервной копии
* Скачать архив данных
* Удалить резервную копию

<figure><img src="../../.gitbook/assets/7 (13).png" alt=""><figcaption></figcaption></figure>

## Восстановление из архива <a href="#vosstanovlenie_iz_arxiva" id="vosstanovlenie_iz_arxiva"></a>

{% hint style="info" %}
Порядок перехода с **Askozia 4, 5 ME** до **MikoPBX** описан в [инструкции](../../manual/maintenance/update.md).
{% endhint %}

1. В списке резервных копий выберите нужную и выполните действие "**Восстановить из резервной копии"**

<figure><img src="../../.gitbook/assets/8 (16).png" alt=""><figcaption></figcaption></figure>

2. Выберите категории данных к восстановлению

<figure><img src="../../.gitbook/assets/9 (8).png" alt=""><figcaption></figcaption></figure>

3. Выполните действие «**Восстановить из архива**»

<figure><img src="../../.gitbook/assets/10 (1).png" alt=""><figcaption></figcaption></figure>

Будет запущен процесс восстановления, после завершения АТС будет перезагружена

Прогресс восстановления данных из архива будет отображен на текущей странице

{% hint style="danger" %}
Рекомендуем восстанавливать данные в два этапа:

1. Восстановление «**Звуковые файлы**» + «**Настройки PBX**» + «**История разговоров**»
2. Восстановление «**Файлы записи разговоров**» - наиболее длительный этап
{% endhint %}

## Резервное копирование по расписанию <a href="#rezervnoe_kopirovanie_po_raspisaniju" id="rezervnoe_kopirovanie_po_raspisaniju"></a>

{% hint style="warning" %}
* Режим **FTP** - будет создан **ZIP** архив. Для данного режима необходимо _наличие ftp-сервера_.
* Режим **SFTP** - создается **IMG** контейнер. Для данного режима достаточно _только самой MikoPBX_.
* Режим **WebDav** - создается **IMG** контейнер.

**Наиболее быстрые варианты** резервного копирования по расписанию - **SFTP** и **WebDav**. FTP морально устарел, со временем возможность использования этого протокола будет исключена из модуля резервного копирования
{% endhint %}

1. Нажмите на кнопку "Расписание архивации" для настройки автоматического резервного копирования.

<figure><img src="../../.gitbook/assets/11 (10).png" alt=""><figcaption></figcaption></figure>

2. Для включения резервного копирования активируйте переключатель «**Архивация по расписанию"**

<figure><img src="../../.gitbook/assets/12 (6).png" alt=""><figcaption></figcaption></figure>

3. Заполните необходимые данные:

* **Адрес сервера** - IP-адрес MikoPBX, или адрес SFTP \ FTP сервера
* **Порт** - для режима **SFTP** порт **22**, при отключении флага «**Режим SFTP**» активируется режим **FTP** - порт **21**
* **Имя пользователя** - имя пользователя для авторизации на сервере
* **Пароль** - пароль для авторизации на сервере
* **Путь на сервере** - директория, в которую будут сохраняться резервные копии. Рекомендуемый каталог на MikoPBX: **/storage/usbdisk1/mikopbx/backup/**

{% hint style="warning" %}
При использовании **WebDav** каталог из поля «**Путь на сервере**» необходимо создать заранее, вручную.
{% endhint %}

* **Расписание** - укажите в какой день выполнять резервное копирование и время, когда запустить операцию
* **Оставлять последние Х версий** - укажите, какое количество версий бекапа должно обязательно сохраняться
* **Настройки PBX** - все **настройки конфигурации** MikoPBX, которые были выполнены в web-интерфейсе в соответствующих разделах
* **История разговоров** - сохранение истории базы данных **cdr.db** (расположение: **/storage/usbdisk1/mikopbx/astlogs/asterisk/cdr.db**). Данная настройка не предполагает сохранение самих записей разговоров, т.е. будет сохранена вся информация на вкладке **Телефония** →[ **История вызовов**](../../manual/telefoniya/call-detail-records.md) без возможности прослушивания / скачивания файлов записей
* **Файлы с записями разговоров** - сохранение всех записей разговоров в формате \*.mp3
* **Звуковые файлы** - сохранение звуковых файлов, которые были загружены на АТС в разделе **Телефония** →[ **Звуковые файлы**](../../manual/telefoniya/sound-files.md)

<figure><img src="../../.gitbook/assets/13 (9).png" alt=""><figcaption></figcaption></figure>

4. Нажмите "**Сохранить**"

<figure><img src="../../.gitbook/assets/14 (1) (1).png" alt=""><figcaption></figcaption></figure>
