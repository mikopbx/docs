# Yandex Cloud

**Яндекс.Облако** — это набор связанных сервисов, которые помогут вам быстро и безопасно взять в аренду вычислительные мощности в тех объемах, в которых это необходимо. Сервис предоставляет пробный период, в течение которого вы сможете ознакомиться со всеми его возможностями.

В этой статье мы покажем, как быстро развернуть виртуальную машину с АТС MikoPBX, используя сервис [Yandex Compute Cloud](https://console.cloud.yandex.ru/?referralCode=dn22bvnhhe64i62i71ua).&#x20;

{% embed url="https://youtu.be/ow2bXcnHjas" %}

## Регистрация в Yandex Cloud <a href="#registracija_v_yandex_cloud" id="registracija_v_yandex_cloud"></a>

Перед началом работы необходимо зарегистрироваться в сервисе. Можете воспользоваться [нашей инструкцией по регистрации.](https://wiki.mikopbx.ru/faq:yandex\_cloud:reg)

<mark style="color:red;">**Перенести саму инструкцию на этот ресурс.**</mark>

## Создание виртуальной машины <a href="#sozdanie_virtualnoj_mashiny" id="sozdanie_virtualnoj_mashiny"></a>

1\. Перейдите в панель управления облаком. **Все сервисы** → **Compute Cloud**.

![](../../.gitbook/assets/ust\_yand\_obl\_0.png)

2\. Создайте новую виртуальную машину.

![](../../.gitbook/assets/ust\_yand\_obl\_1.png)

3\. Заполните поля **Имя.** Для удобства можете заполнить **Описание**. Выберите подходящую для вас зону доступности. О зонах доступности описано в [документации сервиса](https://cloud.yandex.ru/docs/overview/concepts/geo-scope).

![](../../.gitbook/assets/ust\_yand\_obl\_2.png)

4\. В меню **Выбор образа/загрузочного диска** перейдите на вкладку **Cloud Marketplace.**  Нажмите **Посмотреть больше**.&#x20;

![](../../.gitbook/assets/ust\_yand\_obl\_3.png)

5\. В списке **Категория** выберите **VoIP.** Затем выберите **MikoPBX IP АТС.**

![](../../.gitbook/assets/ust\_yand\_obl\_4.png)

6\. Нажмите **Использовать**.

![](../../.gitbook/assets/ust\_yand\_obl\_5.png)

7\. В меню **Диски и файловые хранилища** появится загрузочный диск. Скорректируйте размер диска до **1 Гб**, этого будет достаточно.

![](../../.gitbook/assets/ust\_yand\_obl\_6.png)

8\. Добавьте еще один диск для хранения записей разговоров. Для этого нажмите **Добавить диск**.

![](../../.gitbook/assets/ust\_yand\_obl\_7.png)

9\. Установите следующие параметры:

Тип диска - **HDD,**&#x20;

размер - **от 20 Гб,**

наполнение - **Пустой.**

Нажмите **Добавить**.

![](../../.gitbook/assets/ust\_yand\_obl\_8.png)

{% hint style="info" %}
Ориентировочно, **1 час** разговора занимает **14Мб** места на диске.
{% endhint %}

10\. Параметры вычислительных ресурсов установите на свое усмотрение исходя из ожидаемой нагрузки на АТС и вашего бюджета.

![](../../.gitbook/assets/ust\_yand\_obl\_9.png)

11\. В разделе сетевые настройки выберите/создайте облачную сеть. Затем в пункте **Подсеть** нажните кнопку выпадающего списка и нажмите **Добавить подсеть**.

![](../../.gitbook/assets/ust\_yand\_obl\_10.png)

12\. Установите **Имя**. Пункт **CIDR** - диапазон адресов установите из ваших предпочтений. В нашем примере мы установили сеть 172.16.31.0 с маской 24 бита (255.255.255.0). Нажмите **Создать**.

![](../../.gitbook/assets/ust\_yand\_obl\_11.png)

13\. **Публичный адрес** и **Внутренний IPv4-адрес** оставьте в положении **Автоматически**.

Установите флажок **Защита от DDoS-атак**.

![](../../.gitbook/assets/ust\_yand\_obl\_12.png)

14\. Сгенерируйте ssh-ключи согласно [инструкции](https://cloud.yandex.ru/docs/compute/operations/vm-connect/ssh?utm\_source=console\&utm\_medium=side-bar-left\&utm\_campaign=compute). \
В поле Логин - **root.**\
В поле **ssh-ключ** введите содержимое вашего открытого ssh-ключа из инструкции выше. \
Установите флажок **Разрешить доступ к серийной консоли.**

![](../../.gitbook/assets/ust\_yand\_obl\_13.png)

15\. На этом настройка ВМ закончена, нажмите **Создать ВМ**.&#x20;

![](../../.gitbook/assets/ust\_yand\_obl\_14.png)

## Запуск АТС

1\. Дождитесь запуска созданной виртуальной машины. Обычно первый запуск занимает 6-8 минут, статус **Running**, еще не означает что система полностью развернулась.

![](../../.gitbook/assets/zap\_yand\_obl\_0.png)

{% hint style="info" %}
При запуске виртуальной машины мы получили динамический IP адрес. Для пробного запуска он подойдет, но в случае настройки системы в рабочем режиме необходимо получить статический IP адрес согласно [инструкции](https://cloud.yandex.ru/docs/compute/operations/vm-control/vm-set-static-ip).&#x20;
{% endhint %}

{% hint style="warning" %}


#### Особенности MikoPBX развернутой в Yandex Cloud <a href="#osobennosti_yandex_cloud" id="osobennosti_yandex_cloud"></a>

АТС, развернутая в облаке из соображений безопасности имеет следующие отличия в начальной настройке:

1. Авторизация по паролю для SSH отключена
2. К SSH можно подключиться по ssh-rsa ключу
3. Имя host системы устанавливается в соответствии с именем машины
4. Firewall включен
5. В настройках сетевого интерфейса автоматически прописывается внешний IP-адрес
{% endhint %}

2\. Перейдите в свойства ВМ, нажав на строчку с запущенной ВМ.

![](../../.gitbook/assets/zap\_yand\_obl\_1.png)

3\. Скопируйте публичный IP-адрес АТС и вставьте в адресную строку браузера.

![](../../.gitbook/assets/zap\_yand\_obl\_2.png)

4\. Откроется веб-интерфейс АТС MikoPBX. Выберите язык web интерфейса.

![](../../.gitbook/assets/zap\_yand\_obl\_0.gif)

5\. В свойствах виртуальной машины скопируйте **Идентификатор**. Он используется в качестве пароля для web-интерфейса.

![
](../../.gitbook/assets/zap\_yand\_obl\_4.png)

6\. Авторизуйтесь в web-интерфейсе

Логин - **admin**

Пароль - <скопированный идентификатор виртуальной машины_>_

![](../../.gitbook/assets/zap\_yand\_obl\_5.png)

7\. Система потребует изменить пароль к web-интерфейсу.

![](../../.gitbook/assets/zap\_yand\_obl\_6.png)

8\. Установите сложный пароль и нажмите **Сохранить**.

![](../../.gitbook/assets/zap\_yand\_obl\_1.gif)

9\. На этом настройка MikoPBX в Яндекс Облаке закончена.\
Можно заняться дальнейшей настройкой АТС .

